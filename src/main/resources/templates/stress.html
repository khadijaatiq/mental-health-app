<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Stress Tracker - MindTrack</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/users.css">
</head>

<body>
<nav class="navbar">
    <div class="logo">MindTrack</div>
    <div class="nav-links">
        <a href="/dashboard">Dashboard</a>
        <a href="/mood">Mood</a>
        <a href="/journal">Journal</a>
        <a href="/goals">Goals</a>
        <a href="/habits">Habits</a>
        <a href="/stress">Stress</a>
        <a href="#" onclick="logout()">Logout</a>
    </div>
</nav>

<div class="container">
    <div class="card">
        <h2>Log Stress Level</h2>
        <form id="stressForm">
            <div class="form-group">
                <label for="stressLevel">Stress Level (1-10)</label>
                <input type="range" id="stressLevel" min="1" max="10" value="5"
                       oninput="this.nextElementSibling.value = this.value">
                <output>5</output>
            </div>
            <div class="form-group">
                <label for="date">Date</label>
                <input type="date" id="date" required>
            </div>
            <div class="form-group">
                <label for="notes">Notes (Optional)</label>
                <textarea id="notes" placeholder="What's causing your stress?"></textarea>
            </div>
            <button type="submit">Log Stress</button>
        </form>
    </div>

    <div class="card">
        <h2>Recent Logs</h2>
        <ul id="stressList" class="stress-list">
            <!-- Stress logs will be loaded here -->
        </ul>
    </div>
</div>

<script>
    // Set default date to today
    document.getElementById('date').valueAsDate = new Date();

    function logout() {
        document.cookie = "JWT=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        window.location.href = '/login';
    }

    function getStressClass(level) {
        if (level <= 3) return 'stress-low';
        if (level <= 7) return 'stress-med';
        return 'stress-high';
    }

    async function loadStress() {
        try {
            const response = await fetch('/api/stress');
            if (response.ok) {
                const stressList = await response.json();
                const list = document.getElementById('stressList');
                list.innerHTML = stressList.map(stress => `
                    <li class="stress-item">
                        <div class="stress-info">
                            <span class="stress-badge ${getStressClass(stress.stressLevel)}">Level: ${stress.stressLevel}</span>
                            <p style="margin: 0.5rem 0 0 0">${stress.notes || ''}</p>
                        </div>
                        <div class="stress-meta">
                            <span>${stress.date}</span>
                        </div>
                    </li>
                `).join('');
            }
        } catch (error) {
            console.error('Error loading stress logs:', error);
        }
    }

    document.getElementById('stressForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const stressLevel = document.getElementById('stressLevel').value;
        const date = document.getElementById('date').value;
        const notes = document.getElementById('notes').value;

        try {
            const response = await fetch('/api/stress', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ stressLevel: parseInt(stressLevel), date, notes })
            });

            if (response.ok) {
                loadStress();
                e.target.reset();
                document.getElementById('date').valueAsDate = new Date();
            }
        } catch (error) {
            console.error('Error saving stress log:', error);
        }
    });

    loadStress();
</script>
</body>

</html>