<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Export Data - MindTrack</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/users.css">
</head>

<body>
<nav class="navbar">
    <div class="logo">MindTrack</div>
    <div class="nav-links">
        <a href="/dashboard">Dashboard</a>
        <a href="/mood">Mood</a>
        <a href="/journal">Journal</a>
        <a href="/goals">Goals</a>
        <a href="/analytics">Analytics</a>
        <a href="/export">Export</a>
        <a href="#" onclick="logout()">Logout</a>
    </div>
</nav>

<div class="container">
    <div class="card">
        <h2>Export Your Data</h2>
        <p class="info-text">
            Download a summary of your mental health journey. You can choose between a detailed PDF report suitable
            for sharing with a counselor, or a CSV file for your own analysis.
        </p>

        <form id="exportForm">
            <div class="form-group">
                <label for="startDate">Start Date</label>
                <input type="date" id="startDate" required>
            </div>
            <div class="form-group">
                <label for="endDate">End Date</label>
                <input type="date" id="endDate" required>
            </div>

            <div class="btn-group">
                <button type="button" class="btn-primary" onclick="download('pdf')">
                    ðŸ“„ Download PDF Report
                </button>
                <button type="button" class="btn-secondary" onclick="download('csv')">
                    ðŸ“Š Download CSV Data
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Set default dates (last 30 days)
    const today = new Date();
    const lastMonth = new Date();
    lastMonth.setDate(today.getDate() - 30);

    document.getElementById('endDate').valueAsDate = today;
    document.getElementById('startDate').valueAsDate = lastMonth;

    function logout() {
        document.cookie = "JWT=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        window.location.href = '/login';
    }

    function download(type) {
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;

        if (!startDate || !endDate) {
            alert('Please select both start and end dates.');
            return;
        }

        const url = `/api/export/${type}?startDate=${startDate}&endDate=${endDate}`;
        window.open(url, '_blank');
    }
</script>
</body>

</html>