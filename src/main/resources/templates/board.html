<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Support Board - MindTrack</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/users.css">
</head>

<body>
<nav class="navbar">
    <div class="logo">MindTrack</div>
    <div class="nav-links">
        <a href="/dashboard">Dashboard</a>
        <a href="/mood">Mood</a>
        <a href="/journal">Journal</a>
        <a href="/goals">Goals</a>
        <a href="/board">Community</a>
        <a href="/resources">Resources</a>
        <a href="#" onclick="logout()">Logout</a>
    </div>
</nav>

<div class="container">
    <div class="card">
        <h2>Share Your Thoughts</h2>
        <p style="color: var(--text-muted); margin-bottom: 1.5rem;">This is a safe space. You can choose to post
            anonymously.</p>
        <form id="postForm">
            <div class="form-group">
                <textarea id="content" required placeholder="Share what's on your mind..."></textarea>
            </div>
            <div class="form-group checkbox-group">
                <input type="checkbox" id="anonymous">
                <label for="anonymous" style="margin: 0">Post Anonymously</label>
            </div>
            <button type="submit">Post</button>
        </form>
    </div>

    <div class="card">
        <h2>Community Posts</h2>
        <ul id="postList" class="post-list">
            <!-- Posts will be loaded here -->
        </ul>
    </div>
</div>

<script>
    function logout() {
        document.cookie = "JWT=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        window.location.href = '/login';
    }
    function formatToDDMMYYYY(dateString) {
        const d = new Date(dateString);
        const day = String(d.getDate()).padStart(2, '0');
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const year = d.getFullYear();
        return `${day}-${month}-${year}`;
    }


    async function loadPosts() {
        try {
            const response = await fetch('/api/posts');
            if (response.ok) {
                const posts = await response.json();
                const list = document.getElementById('postList');
                list.innerHTML = posts.map(post => `
                    <li class="post-item">
                        <div class="post-header">
                            <span class="author">${post.username || 'Anonymous'}</span>
                            <span>${formatToDDMMYYYY(post.date)}</span>
                        </div>
                        <div class="post-content">${post.content}</div>
                    </li>
                `).join('');
            }
        } catch (error) {
            console.error('Error loading posts:', error);
        }
    }

    document.getElementById('postForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const content = document.getElementById('content').value;
        const anonymous = document.getElementById('anonymous').checked;

        try {
            const response = await fetch('/api/posts', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ content, anonymous })
            });

            if (response.ok) {
                loadPosts();
                e.target.reset();
            }
        } catch (error) {
            console.error('Error saving post:', error);
        }
    });

    loadPosts();
</script>
</body>

</html>